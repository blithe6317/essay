## Git 分支简介

在 Git 基础中，我们知道了 Git 保存的不是文件的变化或者差异，而是一系列不同时间的文件快照。

在进行提交操作时，Git 会保存一个提交对象，该对象会包含一个指向暂存内容快照的指针，且改提交对象还包含了作者的姓名、邮箱、提交信息以及指向它的父对象的指针。首次提交的提交对象没有父对象，普通提交的操作产生的提交对象有一个父对象，由多个分支合并产生的提交对象有多个父对象。

我们假设有一个工作目录，里面包含了三个将要被暂存&提交的文件。暂存操作会为每一个文件计算校验和（SHA-1），然后会把当前版本的文件快照保存到 Git 仓库中（Git 使用 blob 对象来保存它们），最终讲校验和加入到暂存区等待提交。

当使用 git commit 进行提交时，Git 会先计算每一个子目录的校验和，然后在 Git 仓库中这些校验和保存为树对象。随后，Git 便会创建一个提交对象，提交对象除了包含上面提到的那些信息外，还包含指向这个树对象的指针。

现在，Git 仓库中有五个对象：三个 blob 对象（保存文件快照）、一个树对象（记录着目录结构和 blob 对象索引）以及一个提交对象（包含着指向前述树对象的指针和所有的提交信息）

![首次提交对象及其树结构](./git-2.png)

做一些修改后再次提交，那么这次产生的提交对象会包含一个指向上次提交对象的指针。

![提交对象及其树结构](./git-3.png)

Git 的分支其实本质上仅仅是指向提交对象的可变指针。Git 默认分支名称是 master。在多次提交操作之后，你其实已经有一个指向最后哪个提交对象的 master 分支。它会在每次提交操作中自动向前移动。

master 分支并不是一个特殊分支。它跟其它分支完全没有任何区别。之所以每个仓库都会有一个 master 分支是因为 git init 命令默认创建了它，并且大多数人懒得修改它。

### 分支创建

```shell
# 创建一个新分支，但不会自动切换到新分支
$ git branch testing
```

只需要一个简单的命令，Git 就会为你创建一个可以移动的新指针。这会在当前所在的提交对象上创建一个新指针。
![创建新分支](./git-4.png)

一个项目有多个分支，如何知道当前是在哪个分支上呢？Git 有一个名为 HEAD 的特殊分支。它指向了当前所在的本地分支。

![创建新分支](./git-5.png)

此时执行 git log --oneline --decorate 即可看到 master 和 testing 分支都是指向了 71ee34 ，HEAD 指向了 master。

```shell
$ git log --oneline --decorate
71ee334 (HEAD -> master, testing) add a,b,c
ca82532 (origin/master, origin/HEAD) test
dbab285 00
e35e70c Initial commit from Create React App

```

### 分支切换

```shell
$ git checkout testing
```

这样 HEAD 就指向了 testing 分支。

![切换新分支](./git-6.png)

切换分支后，我们再提交一次。

![切换新分支](./git-7.png)

如图所示，testing 分支向前移动了，但是 master 分支并没有，它仍然指向了 git checkout 时所指的对象。我们再切回 master 分支：

```shell
$ git checkout master
```

![切回分支](./git-8.png)
